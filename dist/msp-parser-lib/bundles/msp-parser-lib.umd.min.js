!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common/http"),require("ngx-logger")):"function"==typeof define&&define.amd?define("msp-parser-lib",["exports","@angular/core","@angular/common/http","ngx-logger"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["msp-parser-lib"]={},e.ng.core,e.ng.common.http,e.i2)}(this,(function(e,t,n,r){"use strict";var i=function(e,t){var n=this;this.http=e,this.logger=t,this.handleName=function(e,t){var r=/(.+)_RI(.*)/.exec(e);return/\s*([:\w\d\s-]+);/.exec(e),r?(t.names.push(n.trim(r[1])),t.meta.push({name:"Retention Index",value:n.trim(r[2]),category:n.findCategory("Retention Index")})):t.names.push(n.trim(e)),t},this.handleMetaDataField=function(e,t,r,i){i||(i="none");for(var o=r,a=o.exec(e);null!=a;){var s=n.trim(a[1]),c=n.trim(a[2]);!1===n.ignoreField(s,c)&&t.meta.push({name:s,value:c,category:i}),a=o.exec(e)}return t},this.trim=function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"").replace(/^"(.*)"$/,"$1")},this.inspectFields=function(e,t){var r=/.*([A-Z]{14}-[A-Z]{10}-[A-Z,0-9])+.*/,i=/^([^J][0-9A-Za-z@+\-\[\]\(\)\\\/%=#$,.~&!]{6,})$/;if(r.exec(e[2]))t.inchiKey=r.exec(e[2])[1];else if("inchi"===e[1].toLowerCase()||"inchicode"===e[1].toLowerCase()||"inchi code"===e[1].toLowerCase())t.inchi=n.trim(e[2]);else if("smiles"===e[1].toLowerCase()&&i.exec(e[2]))t.smiles=i.exec(e[2])[1];else if("comment"===e[1].toLowerCase())t=n.handleMetaDataField(e[2],t,/(\w+)\s*=\s*([0-9]*\.?[0-9]+)/g,void 0);else if("searchid"===e[1].toLowerCase())t=n.handleMetaDataField(e[2],t,/(\w+\s?\w*)+:\s*([\w\d]+[ \w\d-]+)/g,"Database Identifier");else if("ms$focused_ion"===e[1].toLowerCase())t=n.handleMetaDataField(e[2],t,/\s*(.+):(.+)/g,"Derivatization");else{var o=e[1],a=e[2];!1===n.ignoreField(o,a)&&t.meta.push({name:o,value:a,category:n.findCategory(o)})}return t},this.findCategory=function(e){var t="none";return""===(e=e.toLocaleLowerCase())||("num peaks"===e||"retentionindex"===e||"retentiontime"===e?t="spectral properties":"instrument"!==e&&"instrumenttype"!==e&&"ionmode"!==e&&"precursormz"!==e||(t="acquisition properties")),t},this.ignoreField=function(e,t){return 0===t.length||"num peaks"===(e=e.toLowerCase())||"numpeaks"===e},this.convertWithCallback=function(e,t){n.logger.debug("starting with parsing new data set...");for(var r=/((?:.*:\s*[^\n]*\n?)+)\n((?:\s*[0-9]*\.?[0-9]+\s+[0-9]*\.?[0-9]+[;\n]?.*\n?)+)/g,i=/\s*([a-zA-Z _$\/]+):(.+)\s/g,o=/([0-9]+\.?[0-9]*)[ \t]+([0-9]*\.?[0-9]+)(?:\s*(?:[;\n])|(?:"?(.+)"?\n?))?/g,a=/([0-9]*\.?[0-9]{3,})/,s=e.toString("utf8"),c=r.exec(s),u=!1;null!=c;){for(var l={meta:[],names:[],spectrum:"",accurate:!1},d=c[0],m=i.exec(d);null!=m;)m[1]=n.trim(m[1]),m[2]=n.trim(m[2]),l="name"===m[1].toLowerCase()||"synon"===m[1].toLowerCase()?n.handleName(m[2],l):n.inspectFields(m,l),m=i.exec(d);for(l.names=l.names.reduce((function(e,t){return e.indexOf(t)<0&&e.push(t),e}),[]),m=o.exec(c[2]),l.spectrum="",l.accurate=!0;null!=m;)u=!0,l.spectrum=l.spectrum+" "+m[1]+":"+m[2],a.test(m[1])||(l.accurate=!1),m[3]&&l.meta.push({name:n.trim(m[3]).replace(/(^"|"$)/g,""),value:m[1],category:"annotation"}),m=o.exec(c[2]);l.spectrum=n.trim(l.spectrum),null!=l.spectrum&&l.names.length>0?t(l):(n.logger.warn("invalid spectra found -> ignored"),t(void 0)),c=r.exec(s)}return u},this.convertFromData=function(e,t){return n.convertWithCallback(e,t)},this.countSpectra=function(e){for(var t=0,n=0;-1!==n;)t++,n=e.indexOf("Num Peaks",n+1);return t}};i.ɵfac=function(e){return new(e||i)(t.ɵɵinject(n.HttpClient),t.ɵɵinject(r.NGXLogger))},i.ɵprov=t.ɵɵdefineInjectable({token:i,factory:i.ɵfac,providedIn:"root"});var o=function(){};o.ɵmod=t.ɵɵdefineNgModule({type:o}),o.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||o)},providers:[i],imports:[[r.LoggerModule.forRoot({level:r.NgxLoggerLevel.DEBUG,serverLogLevel:r.NgxLoggerLevel.OFF}),n.HttpClientModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(o,{imports:[r.LoggerModule,n.HttpClientModule]}),e.MspParserLibModule=o,e.MspParserLibService=i,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=msp-parser-lib.umd.min.js.map